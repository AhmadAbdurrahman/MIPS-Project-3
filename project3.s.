# program: 1000 char string
# N = 31
# M = 21


.data
sum: .word  0 
user_string: .space 1001 
comma: .asciiz ","
error_message: .asciiz "-" 
buffer: .space 1001

.text
main:
li $v0, 8 
la $a0, buffer 
li $a1, 1001
syscall 

addi $sp, $sp, -4 
sw $a0, 0($sp) 
jal sub_a

li $v0, 10
syscall 

sub_a:
move $s6, $ra 
lw  $t6, 0($sp) 
addi $sp, $sp, -4 

addi $a3, $zero, 0
addi $t2, $zero, 0 
la $a0, user_string

sub_loop:
add $t1, $t6, $a3 
add $t4, $a0, $t2 
lb $t1, ($t1)
beq $t1, 59, go2SubB 
bgt $a3, 1000, go2SubB 
sb $t1, ($t4) 

addi $a3, $a3, 1
addi $t2, $t2, 1 
j sub_loop

go2SubB:
move $t7, $ra
addi $sp, $sp, -4 
sw $a0, 0($sp) 
jal sub_b

lw  $t7, 0($sp)
addi $sp, $sp, -4 #resets stack
beq $t7, -1, invalid

li $v0, 1
move $a0,$t7
syscall
j loop2

invalid:
li $v0,4
la $a0, error_message 
syscall

loop2:
bgt $a3, 1000, end_sub_a

li $v0, 4
la $a0, comma
syscall

addi $t2, $zero, 0
la $a0, user_string 
addi $a3, $a3, 1
j sub_loop

end_sub_a:
move $ra, $s6
jr $ra

sub_b:
move $t7,$ra
lw  $s7, 0($sp) 

move $a1,$s7
addi $a0, $zero, 0
jal firstConst
move $s1, $v0 

move $a1,$s1 
addi $a0, $zero, 0
jal endspace
move $s3, $v0 

beqz $s3, invalidchars 
bgt $s3,4 ,invalidchars 

move $a0, $s1
move $a1, $s3
jal ConstantVal
move $s5, $v1
beq $s5, -1, invalidchars
j endSub_b

firstConst:
addu $t4,$a0,$a1 
lbu $a2,0($t4)   
bne $a2,32,removefirstConst
bge $a0,1000,removefirstConst
addi $a0,$a0,1   
j firstConst    

endfirstConst:  
move $v0, $t4
jr $ra

endspace:
addi $t2, $zero, 0

loop:
addu $t4,$a0,$a1 
lbu $a2,0($t4)   
ble $a2, 47, invalid1 
ble $a2, 58, validchars 
ble $a2, 121, validchars  